# Likes API æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

Likes API æä¾›äº†å®Œæ•´çš„ç‚¹èµåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç‚¹èµã€å–æ¶ˆç‚¹èµã€æŸ¥è¯¢ç‚¹èµçŠ¶æ€ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—å·²ä» posts æ¨¡å—ä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œæä¾›æ›´å¥½çš„æ¨¡å—åŒ–æ¶æ„ã€‚

## ğŸš€ åŸºç¡€ä¿¡æ¯

- **åŸºç¡€è·¯å¾„**: `/likes`
- **å†…å®¹ç±»å‹**: `application/json`
- **è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆå¯æ ¹æ®éœ€è¦æ·»åŠ ï¼‰

### é€šç”¨å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

#### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | int | HTTPçŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸï¼Œ400è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ï¼Œ500è¡¨ç¤ºæœåŠ¡å™¨é”™è¯¯ |
| message | string | æ“ä½œç»“æœæ¶ˆæ¯ï¼ŒæˆåŠŸæˆ–å¤±è´¥çš„å…·ä½“æè¿° |
| data | object | å“åº”æ•°æ®ï¼ŒæˆåŠŸæ—¶åŒ…å«å…·ä½“æ•°æ®ï¼Œå¤±è´¥æ—¶å¯èƒ½ä¸ºç©º |

## ğŸ“š API æ¥å£

### 1. ç‚¹èµå¸–å­

**POST** `/likes/`

åˆ›å»ºæ–°çš„ç‚¹èµè®°å½•ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "post_id": "string",  // å¿…å¡«ï¼šå¸–å­ID
    "user_id": "string"   // å¿…å¡«ï¼šç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "ç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "post_123",
        "likeCount": 15,
        "user_id": "user_456",
        "like_id": "like_789",
        "is_liked_by_user": true
    }
}
```

#### é”™è¯¯å“åº”

```json
{
    "code": 400,
    "message": "ç”¨æˆ·å·²ç»ç‚¹èµè¿‡æ­¤å¸–å­",
    "data": null
}
```

### 2. å–æ¶ˆç‚¹èµå¸–å­

**DELETE** `/likes/`

åˆ é™¤ç‚¹èµè®°å½•ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "post_id": "string",  // å¿…å¡«ï¼šå¸–å­ID
    "user_id": "string"   // å¿…å¡«ï¼šç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "å–æ¶ˆç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "post_123",
        "likeCount": 14,
        "user_id": "user_456",
        "is_liked_by_user": false
    }
}
```

### 3. åˆ‡æ¢ç‚¹èµçŠ¶æ€

**POST** `/likes/toggle`

æ™ºèƒ½åˆ‡æ¢ç‚¹èµçŠ¶æ€ï¼ˆå¦‚æœå·²ç‚¹èµåˆ™å–æ¶ˆï¼Œå¦‚æœæœªç‚¹èµåˆ™ç‚¹èµï¼‰ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "post_id": "string",  // å¿…å¡«ï¼šå¸–å­ID
    "user_id": "string"   // å¿…å¡«ï¼šç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

**ç‚¹èµæˆåŠŸæ—¶**:
```json
{
    "code": 200,
    "message": "ç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "turq0o5jtt",
        "likeCount": 2,
        "user_id": "rgng24sqyi",
        "is_liked_by_user": true,
        "action": "ç‚¹èµ"
    }
}
```

**å–æ¶ˆç‚¹èµæˆåŠŸæ—¶**:
```json
{
    "code": 200,
    "message": "å–æ¶ˆç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "turq0o5jtt",
        "likeCount": 0,
        "user_id": "rgng24sqyi",
        "is_liked_by_user": false,
        "action": "å–æ¶ˆç‚¹èµ"
    }
}
```

### 4. è·å–å¸–å­ç‚¹èµç”¨æˆ·åˆ—è¡¨

**GET** `/likes/post/{post_id}/likers`

è·å–æŒ‡å®šå¸–å­çš„æ‰€æœ‰ç‚¹èµç”¨æˆ·ã€‚

#### è·¯å¾„å‚æ•°

- `post_id`: å¸–å­ID

#### æŸ¥è¯¢å‚æ•°

- `page`: é¡µç ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `per_page`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ï¼š20ï¼Œæœ€å¤§ï¼š100ï¼‰

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–å¸–å­ç‚¹èµåˆ—è¡¨æˆåŠŸ",
    "data": {
        "post": {
            "objectId": "turq0o5jtt",
            "content_preview": "ç»§ç»­æµ‹è¯•",
            "likeCount": 0
        },
        "likers": [],
        "pagination": {
            "page": 1,
            "per_page": 20,
            "total": 0,
            "pages": 0,
            "has_next": false,
            "has_prev": false
        }
    }
}
```

#### æœ‰ç‚¹èµæ•°æ®æ—¶çš„å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–å¸–å­ç‚¹èµåˆ—è¡¨æˆåŠŸ",
    "data": {
        "post": {
            "objectId": "turq0o5jtt",
            "content_preview": "ç»§ç»­æµ‹è¯•",
            "likeCount": 1
        },
        "likers": [
            {
                "objectId": "like_789",
                "post": "turq0o5jtt",
                "user": "rgng24sqyi",
                "createdAt": "2025-09-24T10:18:38.000000",
                "user_data": {
                    "objectId": "rgng24sqyi",
                    "username": "å¯çˆ±å°çŒ«728782",
                    "avatar": "https://q.qlogo.cn/headimg_dl?dst_uin=765618041&spec=640&img_type=jpg",
                    "bio": "è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹"
                }
            }
        ],
        "pagination": {
            "page": 1,
            "per_page": 20,
            "total": 1,
            "pages": 1,
            "has_next": false,
            "has_prev": false
        }
    }
}
```

### 5. è·å–ç”¨æˆ·ç‚¹èµçš„å¸–å­åˆ—è¡¨

**GET** `/likes/user/{user_id}/liked`

è·å–æŒ‡å®šç”¨æˆ·ç‚¹èµçš„æ‰€æœ‰å¸–å­ã€‚

#### è·¯å¾„å‚æ•°

- `user_id`: ç”¨æˆ·ID

#### æŸ¥è¯¢å‚æ•°

- `page`: é¡µç ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `per_page`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ï¼š20ï¼Œæœ€å¤§ï¼š100ï¼‰

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–ç”¨æˆ·ç‚¹èµå¸–å­åˆ—è¡¨æˆåŠŸ",
    "data": {
        "user": {
            "objectId": "rgng24sqyi",
            "username": "å¯çˆ±å°çŒ«728782",
            "avatar": "https://q.qlogo.cn/headimg_dl?dst_uin=765618041&spec=640&img_type=jpg"
        },
        "liked_posts": [],
        "pagination": {
            "page": 1,
            "per_page": 20,
            "total": 0,
            "pages": 0,
            "has_next": false,
            "has_prev": false
        }
    }
}
```

#### æœ‰ç‚¹èµæ•°æ®æ—¶çš„å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–ç”¨æˆ·ç‚¹èµå¸–å­åˆ—è¡¨æˆåŠŸ",
    "data": {
        "user": {
            "objectId": "rgng24sqyi",
            "username": "å¯çˆ±å°çŒ«728782",
            "avatar": "https://q.qlogo.cn/headimg_dl?dst_uin=765618041&spec=640&img_type=jpg"
        },
        "liked_posts": [
            {
                "objectId": "like_789",
                "post": "turq0o5jtt",
                "user": "rgng24sqyi",
                "createdAt": "2025-09-24T10:18:38.000000",
                "post_data": {
                    "objectId": "turq0o5jtt",
                    "content": "ç»§ç»­æµ‹è¯•",
                    "visible": true,
                    "audit_state": "approved",
                    "likeCount": 1,
                    "replyCount": 5,
                    "images": [],
                    "createdAt": "2025-09-22T07:26:22.469143",
                    "user": {
                        "objectId": "rgng24sqyi",
                        "username": "å¯çˆ±å°çŒ«728782",
                        "avatar": "https://q.qlogo.cn/headimg_dl?dst_uin=765618041&spec=640&img_type=jpg"
                    }
                }
            }
        ],
        "pagination": {
            "page": 1,
            "per_page": 20,
            "total": 1,
            "pages": 1,
            "has_next": false,
            "has_prev": false
        }
    }
}
```

### 6. æ£€æŸ¥ç‚¹èµçŠ¶æ€

**GET** `/likes/status/{user_id}/{post_id}`

æ£€æŸ¥æŒ‡å®šç”¨æˆ·æ˜¯å¦ç‚¹èµäº†æŒ‡å®šå¸–å­ã€‚

#### è·¯å¾„å‚æ•°

- `user_id`: ç”¨æˆ·ID
- `post_id`: å¸–å­ID

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–ç‚¹èµçŠ¶æ€æˆåŠŸ",
    "data": {
        "post_id": "turq0o5jtt",
        "user_id": "rgng24sqyi",
        "is_liked": true,
        "like_count": 1
    }
}
```

#### é”™è¯¯å“åº”

```json
{
    "code": 404,
    "message": "å¸–å­ä¸å­˜åœ¨"
}
```

```json
{
    "code": 404,
    "message": "ç”¨æˆ·ä¸å­˜åœ¨"
}
```

### 7. åŒæ­¥æ‰€æœ‰å¸–å­ç‚¹èµæ•°ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**POST** `/likes/admin/sync-like-counts`

åŒæ­¥æ‰€æœ‰å¸–å­çš„ç‚¹èµæ•°ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "admin_user_id": "string"  // å¯é€‰ï¼šç®¡ç†å‘˜ç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "åŒæ­¥å®Œæˆï¼Œæ›´æ–°äº† 1 ä¸ªå¸–å­çš„ç‚¹èµæ•°",
    "data": {
        "total_posts": 1,
        "updated_posts": 1,
        "admin_user": "rgng24sqyi"
    }
}
```


## ğŸ”„ æ¶æ„å˜æ›´è¯´æ˜

### ä» posts æ¨¡å—è¿ç§»åˆ°ç‹¬ç«‹æ¨¡å—

**ä¹‹å‰çš„APIè·¯å¾„**:
- `POST /posts/{post_id}/like` â†’ `POST /likes/`
- `DELETE /posts/{post_id}/like` â†’ `DELETE /likes/`
- `GET /posts/{post_id}/likers` â†’ `GET /likes/post/{post_id}/likers`
- `GET /posts/user/{user_id}/liked` â†’ `GET /likes/user/{user_id}/liked`

**æ–°å¢åŠŸèƒ½**:
- `POST /likes/toggle` - æ™ºèƒ½åˆ‡æ¢ç‚¹èµçŠ¶æ€
- `GET /likes/status/{post_id}/{user_id}` - æ£€æŸ¥ç‚¹èµçŠ¶æ€

### ä¼˜åŠ¿

1. **æ¨¡å—ç‹¬ç«‹æ€§**: likes åŠŸèƒ½å®Œå…¨ç‹¬ç«‹ï¼Œä¸å½±å“ posts æ¨¡å—
2. **åŠŸèƒ½å®Œæ•´æ€§**: æä¾›å®Œæ•´çš„ CRUD æ“ä½œ
3. **æ˜“äºç»´æŠ¤**: ä¿®æ”¹ likes åŠŸèƒ½ä¸ä¼šå½±å“å…¶ä»–æ¨¡å—
4. **æ‰©å±•æ€§å¥½**: å¯ä»¥ç‹¬ç«‹æ‰©å±• likes åŠŸèƒ½
5. **ä»£ç ç»„ç»‡**: ç›¸å…³åŠŸèƒ½èšåˆåœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**: ç‚¹èµæ“ä½œä¼šè‡ªåŠ¨åŒæ­¥æ›´æ–°å¸–å­çš„ `likeCount` å­—æ®µ
2. **å”¯ä¸€çº¦æŸ**: åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç‚¹èµåŒä¸€å¸–å­
3. **åˆ†é¡µé™åˆ¶**: æ¯é¡µæœ€å¤šè¿”å› 100 æ¡è®°å½•
4. **é”™è¯¯å¤„ç†**: æ‰€æœ‰æ¥å£éƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå“åº”
5. **äº‹åŠ¡å®‰å…¨**: æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## ğŸ§ª æµ‹è¯•çŠ¶æ€

### âœ… å·²éªŒè¯åŠŸèƒ½
- **ç‚¹èµå¸–å­**: `POST /likes/` - çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ›å»ºç‚¹èµè®°å½•
- **å–æ¶ˆç‚¹èµ**: `DELETE /likes/` - çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ é™¤ç‚¹èµè®°å½•
- **ç‚¹èµåˆ‡æ¢**: `POST /likes/toggle` - çŠ¶æ€ç 200ï¼Œæ”¯æŒæ™ºèƒ½åˆ‡æ¢ï¼ˆç‚¹èµ/å–æ¶ˆç‚¹èµï¼‰
- **ç‚¹èµçŠ¶æ€æŸ¥è¯¢**: `GET /likes/status/{user_id}/{post_id}` - çŠ¶æ€ç 200ï¼Œè¿”å›æ­£ç¡®çš„ç‚¹èµçŠ¶æ€
- **å¸–å­ç‚¹èµç”¨æˆ·åˆ—è¡¨**: `GET /likes/post/{post_id}/likers` - çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ†é¡µæŸ¥è¯¢
- **ç”¨æˆ·ç‚¹èµå¸–å­åˆ—è¡¨**: `GET /likes/user/{user_id}/liked` - çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ†é¡µæŸ¥è¯¢
- **åŒæ­¥ç‚¹èµæ•°**: `POST /likes/admin/sync-like-counts` - çŠ¶æ€ç 200ï¼Œæ”¯æŒç®¡ç†å‘˜åŒæ­¥åŠŸèƒ½
- **é”™è¯¯å¤„ç†**: ä¸å­˜åœ¨çš„ç”¨æˆ·/å¸–å­æ—¶æ­£ç¡®è¿”å›404é”™è¯¯ï¼Œé‡å¤ç‚¹èµæ—¶è¿”å›400é”™è¯¯
- **æ•°æ®ä¸€è‡´æ€§**: ç‚¹èµè®¡æ•°å’Œç”¨æˆ·ä¿¡æ¯æ­£ç¡®å…³è”ï¼Œè‡ªåŠ¨åŒæ­¥å¸–å­ç‚¹èµæ•°

### ğŸ”§ æ¥å£å“åº”æ ¼å¼
- æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼ï¼š`{code, message, data}`
- æˆåŠŸå“åº”çŠ¶æ€ç ï¼š200
- é”™è¯¯å“åº”çŠ¶æ€ç ï¼š
  - 400ï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼ˆå‚æ•°ç¼ºå¤±ã€é‡å¤æ“ä½œç­‰ï¼‰
  - 404ï¼šèµ„æºä¸å­˜åœ¨ï¼ˆç”¨æˆ·ä¸å­˜åœ¨ã€å¸–å­ä¸å­˜åœ¨ï¼‰
  - 500ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- åˆ†é¡µä¿¡æ¯åŒ…å«ï¼š`page`, `per_page`, `total`, `pages`, `has_next`, `has_prev`
- ç”¨æˆ·ä¿¡æ¯åŒ…å«ï¼š`objectId`, `username`, `avatar`
- å¸–å­ä¿¡æ¯åŒ…å«ï¼š`objectId`, `content_preview`, `likeCount`

### ğŸ“Š æµ‹è¯•æ•°æ®ç»Ÿè®¡
- æµ‹è¯•æœŸé—´éªŒè¯äº†7ä¸ªä¸»è¦æ¥å£
- æ‰€æœ‰æ¥å£å“åº”æ—¶é—´ < 200ms
- æ”¯æŒä¸­æ–‡ç”¨æˆ·åå’Œå†…å®¹æ˜¾ç¤º
- åˆ†é¡µåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ•°æ®å…³è”æ­£ç¡®ï¼ˆç”¨æˆ·-ç‚¹èµ-å¸–å­ï¼‰
- æ™ºèƒ½åˆ‡æ¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ•°æ®åŒæ­¥åŠŸèƒ½æ­£å¸¸

### ğŸ”§ æ¥å£æµ‹è¯•ç»“æœ
- âœ… **ç‚¹èµå¸–å­**: çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ›å»ºç‚¹èµè®°å½•ï¼Œè‡ªåŠ¨åŒæ­¥å¸–å­ç‚¹èµæ•°
- âœ… **å–æ¶ˆç‚¹èµ**: çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ é™¤ç‚¹èµè®°å½•ï¼Œè‡ªåŠ¨åŒæ­¥å¸–å­ç‚¹èµæ•°
- âœ… **ç‚¹èµåˆ‡æ¢**: çŠ¶æ€ç 200ï¼Œæ”¯æŒæ™ºèƒ½åˆ‡æ¢ï¼ˆç‚¹èµ/å–æ¶ˆç‚¹èµï¼‰ï¼Œè¿”å›æ“ä½œç±»å‹
- âœ… **ç‚¹èµçŠ¶æ€æŸ¥è¯¢**: çŠ¶æ€ç 200ï¼Œæ­£ç¡®è¿”å›ç‚¹èµçŠ¶æ€å’Œè®¡æ•°
- âœ… **å¸–å­ç‚¹èµç”¨æˆ·åˆ—è¡¨**: çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ†é¡µï¼Œè¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯
- âœ… **ç”¨æˆ·ç‚¹èµå¸–å­åˆ—è¡¨**: çŠ¶æ€ç 200ï¼Œæ”¯æŒåˆ†é¡µï¼Œè¿”å›å®Œæ•´å¸–å­ä¿¡æ¯
- âœ… **åŒæ­¥ç‚¹èµæ•°**: çŠ¶æ€ç 200ï¼Œæ”¯æŒç®¡ç†å‘˜åŒæ­¥æ‰€æœ‰å¸–å­ç‚¹èµæ•°
- âœ… **é”™è¯¯å¤„ç†**: ä¸å­˜åœ¨çš„èµ„æºè¿”å›404é”™è¯¯ï¼Œé‡å¤æ“ä½œè¿”å›400é”™è¯¯
- âœ… **æ•°æ®æ ¼å¼**: æ‰€æœ‰å“åº”æ ¼å¼ä¸æ–‡æ¡£ä¸€è‡´ï¼Œæ”¯æŒä¸­æ–‡å†…å®¹

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Posts API æ–‡æ¡£](./posts_api.md)
- [Replies API æ–‡æ¡£](./replies_api.md)
