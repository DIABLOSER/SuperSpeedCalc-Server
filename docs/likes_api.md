# Likes API æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

Likes API æä¾›äº†å®Œæ•´çš„ç‚¹èµåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç‚¹èµã€å–æ¶ˆç‚¹èµã€æŸ¥è¯¢ç‚¹èµçŠ¶æ€ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—å·²ä» posts æ¨¡å—ä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œæä¾›æ›´å¥½çš„æ¨¡å—åŒ–æ¶æ„ã€‚

## ğŸš€ åŸºç¡€ä¿¡æ¯

- **åŸºç¡€è·¯å¾„**: `/likes`
- **å†…å®¹ç±»å‹**: `application/json`
- **è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆå¯æ ¹æ®éœ€è¦æ·»åŠ ï¼‰

### é€šç”¨å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

#### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | int | HTTPçŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸï¼Œ400è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ï¼Œ500è¡¨ç¤ºæœåŠ¡å™¨é”™è¯¯ |
| message | string | æ“ä½œç»“æœæ¶ˆæ¯ï¼ŒæˆåŠŸæˆ–å¤±è´¥çš„å…·ä½“æè¿° |
| data | object | å“åº”æ•°æ®ï¼ŒæˆåŠŸæ—¶åŒ…å«å…·ä½“æ•°æ®ï¼Œå¤±è´¥æ—¶å¯èƒ½ä¸ºç©º |

## ğŸ“š API æ¥å£

### 1. ç‚¹èµå¸–å­

**POST** `/likes/`

åˆ›å»ºæ–°çš„ç‚¹èµè®°å½•ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "post_id": "string",  // å¿…å¡«ï¼šå¸–å­ID
    "user_id": "string"   // å¿…å¡«ï¼šç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "success": true,
    "message": "ç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "post_123",
        "likeCount": 15,
        "user_id": "user_456",
        "like_id": "like_789",
        "is_liked_by_user": true
    }
}
```

#### é”™è¯¯å“åº”

```json
{
    "code": 400,
    "message": "ç”¨æˆ·å·²ç»ç‚¹èµè¿‡æ­¤å¸–å­"
}
```

### 2. å–æ¶ˆç‚¹èµå¸–å­

**DELETE** `/likes/`

åˆ é™¤ç‚¹èµè®°å½•ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "post_id": "string",  // å¿…å¡«ï¼šå¸–å­ID
    "user_id": "string"   // å¿…å¡«ï¼šç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "å–æ¶ˆç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "post_123",
        "likeCount": 14,
        "user_id": "user_456",
        "is_liked_by_user": false
    }
}
```

### 3. åˆ‡æ¢ç‚¹èµçŠ¶æ€

**POST** `/likes/toggle`

æ™ºèƒ½åˆ‡æ¢ç‚¹èµçŠ¶æ€ï¼ˆå¦‚æœå·²ç‚¹èµåˆ™å–æ¶ˆï¼Œå¦‚æœæœªç‚¹èµåˆ™ç‚¹èµï¼‰ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "post_id": "string",  // å¿…å¡«ï¼šå¸–å­ID
    "user_id": "string"   // å¿…å¡«ï¼šç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "ç‚¹èµæˆåŠŸ",
    "data": {
        "post_id": "post_123",
        "likeCount": 15,
        "user_id": "user_456",
        "is_liked_by_user": true,
        "action": "ç‚¹èµ"
    }
}
```

### 4. è·å–å¸–å­ç‚¹èµç”¨æˆ·åˆ—è¡¨

**GET** `/likes/post/{post_id}/likers`

è·å–æŒ‡å®šå¸–å­çš„æ‰€æœ‰ç‚¹èµç”¨æˆ·ã€‚

#### è·¯å¾„å‚æ•°

- `post_id`: å¸–å­ID

#### æŸ¥è¯¢å‚æ•°

- `page`: é¡µç ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `per_page`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ï¼š20ï¼Œæœ€å¤§ï¼š100ï¼‰

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–å¸–å­ç‚¹èµåˆ—è¡¨æˆåŠŸ",
    "data": {
        "post": {
            "objectId": "post_123",
            "content_preview": "è¿™æ˜¯ä¸€ç¯‡å…³äº...",
            "likeCount": 15
        },
        "likers": [
            {
                "objectId": "like_789",
                "post": "post_123",
                "user": "user_456",
                "createdAt": "2024-01-15T10:30:00Z",
                "user_data": {
                    "objectId": "user_456",
                    "username": "å¼ ä¸‰",
                    "avatar": "avatar_url",
                    "bio": "ç”¨æˆ·ç®€ä»‹"
                }
            }
        ],
        "pagination": {
            "page": 1,
            "per_page": 20,
            "total": 15,
            "pages": 1,
            "has_next": false,
            "has_prev": false
        }
    }
}
```

### 5. è·å–ç”¨æˆ·ç‚¹èµçš„å¸–å­åˆ—è¡¨

**GET** `/likes/user/{user_id}/liked`

è·å–æŒ‡å®šç”¨æˆ·ç‚¹èµçš„æ‰€æœ‰å¸–å­ã€‚

#### è·¯å¾„å‚æ•°

- `user_id`: ç”¨æˆ·ID

#### æŸ¥è¯¢å‚æ•°

- `page`: é¡µç ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `per_page`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ï¼š20ï¼Œæœ€å¤§ï¼š100ï¼‰

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–ç”¨æˆ·ç‚¹èµå¸–å­åˆ—è¡¨æˆåŠŸ",
    "data": {
        "user": {
            "objectId": "user_456",
            "username": "å¼ ä¸‰",
            "avatar": "avatar_url"
        },
        "liked_posts": [
            {
                "objectId": "like_789",
                "post": "post_123",
                "user": "user_456",
                "createdAt": "2024-01-15T10:30:00Z",
                "post_data": {
                    "objectId": "post_123",
                    "content": "å®Œæ•´çš„å¸–å­å†…å®¹...",
                    "visible": true,
                    "audit_state": "approved",
                    "likeCount": 15,
                    "replyCount": 3,
                    "images": ["image1.jpg", "image2.jpg"],
                    "createdAt": "2024-01-15T09:00:00Z",
                    "user": {
                        "objectId": "user_789",
                        "username": "æå››",
                        "avatar": "avatar_url"
                    }
                }
            }
        ],
        "pagination": {
            "page": 1,
            "per_page": 20,
            "total": 5,
            "pages": 1,
            "has_next": false,
            "has_prev": false
        }
    }
}
```

### 6. æ£€æŸ¥ç‚¹èµçŠ¶æ€

**GET** `/likes/status/{post_id}/{user_id}`

æ£€æŸ¥æŒ‡å®šç”¨æˆ·æ˜¯å¦ç‚¹èµäº†æŒ‡å®šå¸–å­ã€‚

#### è·¯å¾„å‚æ•°

- `post_id`: å¸–å­ID
- `user_id`: ç”¨æˆ·ID

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "è·å–ç‚¹èµçŠ¶æ€æˆåŠŸ",
    "data": {
        "post_id": "post_123",
        "user_id": "user_456",
        "is_liked": true,
        "like_count": 15
    }
}
```

### 7. åŒæ­¥æ‰€æœ‰å¸–å­ç‚¹èµæ•°ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

**POST** `/likes/admin/sync-like-counts`

åŒæ­¥æ‰€æœ‰å¸–å­çš„ç‚¹èµæ•°ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

#### è¯·æ±‚å‚æ•°

```json
{
    "admin_user_id": "string"  // å¯é€‰ï¼šç®¡ç†å‘˜ç”¨æˆ·ID
}
```

#### å“åº”ç¤ºä¾‹

```json
{
    "code": 200,
    "message": "åŒæ­¥å®Œæˆï¼Œæ›´æ–°äº† 3 ä¸ªå¸–å­çš„ç‚¹èµæ•°",
    "data": {
        "total_posts": 100,
        "updated_posts": 3,
        "admin_user": "admin_123"
    }
}
```


## ğŸ”„ æ¶æ„å˜æ›´è¯´æ˜

### ä» posts æ¨¡å—è¿ç§»åˆ°ç‹¬ç«‹æ¨¡å—

**ä¹‹å‰çš„APIè·¯å¾„**:
- `POST /posts/{post_id}/like` â†’ `POST /likes/`
- `DELETE /posts/{post_id}/like` â†’ `DELETE /likes/`
- `GET /posts/{post_id}/likers` â†’ `GET /likes/post/{post_id}/likers`
- `GET /posts/user/{user_id}/liked` â†’ `GET /likes/user/{user_id}/liked`

**æ–°å¢åŠŸèƒ½**:
- `POST /likes/toggle` - æ™ºèƒ½åˆ‡æ¢ç‚¹èµçŠ¶æ€
- `GET /likes/status/{post_id}/{user_id}` - æ£€æŸ¥ç‚¹èµçŠ¶æ€

### ä¼˜åŠ¿

1. **æ¨¡å—ç‹¬ç«‹æ€§**: likes åŠŸèƒ½å®Œå…¨ç‹¬ç«‹ï¼Œä¸å½±å“ posts æ¨¡å—
2. **åŠŸèƒ½å®Œæ•´æ€§**: æä¾›å®Œæ•´çš„ CRUD æ“ä½œ
3. **æ˜“äºç»´æŠ¤**: ä¿®æ”¹ likes åŠŸèƒ½ä¸ä¼šå½±å“å…¶ä»–æ¨¡å—
4. **æ‰©å±•æ€§å¥½**: å¯ä»¥ç‹¬ç«‹æ‰©å±• likes åŠŸèƒ½
5. **ä»£ç ç»„ç»‡**: ç›¸å…³åŠŸèƒ½èšåˆåœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**: ç‚¹èµæ“ä½œä¼šè‡ªåŠ¨åŒæ­¥æ›´æ–°å¸–å­çš„ `likeCount` å­—æ®µ
2. **å”¯ä¸€çº¦æŸ**: åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤ç‚¹èµåŒä¸€å¸–å­
3. **åˆ†é¡µé™åˆ¶**: æ¯é¡µæœ€å¤šè¿”å› 100 æ¡è®°å½•
4. **é”™è¯¯å¤„ç†**: æ‰€æœ‰æ¥å£éƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå“åº”
5. **äº‹åŠ¡å®‰å…¨**: æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Posts API æ–‡æ¡£](./posts_api.md)
- [Replies API æ–‡æ¡£](./replies_api.md)
