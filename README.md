# SuperSpeedCalc Server

åŸºäº Flask æ¡†æ¶çš„å…¨åŠŸèƒ½åç«¯æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„ç¤¾äº¤åŒ–åº”ç”¨åŠŸèƒ½ã€‚

> âœ… **APIå“åº”æ ¼å¼å·²å®Œå…¨æ ‡å‡†åŒ–** - æ‰€æœ‰æ¥å£ç»Ÿä¸€ä½¿ç”¨ `code + message + data` æ ¼å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- SQLite æ•°æ®åº“

### å®‰è£…è¿è¡Œ
```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆé€‰æ‹©ç¯å¢ƒï¼‰
python start_development.py    # å¼€å‘ç¯å¢ƒ - ç«¯å£ 8000
python start_production.py     # ç”Ÿäº§ç¯å¢ƒ - ç«¯å£ 8001
```

### ç¯å¢ƒè¯´æ˜
- **å¼€å‘ç¯å¢ƒ** (`start_development.py`): `http://localhost:8000` - ç”¨äºå¼€å‘å’Œæµ‹è¯•
- **ç”Ÿäº§ç¯å¢ƒ** (`start_production.py`): `http://localhost:8001` - ç”¨äºç”Ÿäº§éƒ¨ç½²

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

é¡¹ç›®åŒ…å«ä»¥ä¸‹æ•°æ®è¡¨ï¼š

| è¡¨å | è¯´æ˜ | ä¸»è¦åŠŸèƒ½ |
|------|------|----------|
| `my_user` | ç”¨æˆ·è¡¨ | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç† |
| `charts` | æ’è¡Œæ¦œè¡¨ | ç”¨æˆ·æˆç»©è®°å½•ã€æ’åç»Ÿè®¡ |
| `image` | å›¾ç‰‡è¡¨ | å›¾ç‰‡ä¸Šä¼ ã€ç®¡ç† |
| `history` | å†å²è®°å½•è¡¨ | ç”¨æˆ·æ“ä½œå†å²è®°å½• |
| `app_releases` | åº”ç”¨å‘å¸ƒè¡¨ | APKç‰ˆæœ¬ç®¡ç†ã€æ›´æ–°æ§åˆ¶ |
| `user_relationships` | ç”¨æˆ·å…³ç³»è¡¨ | å…³æ³¨/ç²‰ä¸å…³ç³»ç®¡ç† |
| `posts` | å¸–å­è¡¨ | ç”¨æˆ·å¸–å­å‘å¸ƒã€ç®¡ç† |
| `likes` | ç‚¹èµè¡¨ | å¸–å­ç‚¹èµåŠŸèƒ½ |
| `replies` | å›å¤è¡¨ | è¯„è®ºå›å¤åŠŸèƒ½ |
| `banners` | æ¨ªå¹…è¡¨ | è½®æ’­å›¾ã€å¹¿å‘Šç®¡ç† |

## ğŸ”§ API å“åº”æ ¼å¼

âœ… **æ‰€æœ‰APIæ¥å£å·²å®Œå…¨æ ‡å‡†åŒ–**ï¼Œä½¿ç”¨ç®€åŒ–çš„å“åº”æ ¼å¼ï¼š

> **æ ‡å‡†åŒ–å®Œæˆ**ï¼šæ‰€æœ‰æ¥å£ç°åœ¨éƒ½ä¸¥æ ¼æŒ‰ç…§ `code + message + data` æ ¼å¼è¿”å›å“åº”ï¼Œç¡®ä¿å‰åç«¯äº¤äº’çš„ä¸€è‡´æ€§ã€‚

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "key": "value"
  }
}
```

### åˆ†é¡µå“åº”
```json
{
  "code": 200,
  "message": "è·å–æ•°æ®æˆåŠŸ",
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "per_page": 10,
      "total": 100,
      "pages": 10
    }
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "é”™è¯¯æè¿°"
}
```

### å“åº”æ ¼å¼è¯´æ˜
- **code**: HTTPçŠ¶æ€ç ï¼ˆ200æˆåŠŸï¼Œ400å®¢æˆ·ç«¯é”™è¯¯ï¼Œ500æœåŠ¡å™¨é”™è¯¯ï¼‰
- **message**: ä¸­æ–‡æç¤ºä¿¡æ¯
- **data**: å®é™…æ•°æ®ï¼ˆJSONå¯¹è±¡ï¼‰ï¼Œä»…æˆåŠŸå“åº”åŒ…å«æ­¤å­—æ®µ
- é”™è¯¯å“åº”åªåŒ…å« `code` å’Œ `message` å­—æ®µï¼Œç®€åŒ–äº†é”™è¯¯å¤„ç†

## ğŸ“š API æ¥å£æ–‡æ¡£

è¯¦ç»†çš„APIæ¥å£æ–‡æ¡£è¯·æŸ¥çœ‹ä»¥ä¸‹æ–‡ä»¶ï¼š

- [ç”¨æˆ·ç®¡ç† API](docs/user_api.md)
- [æ’è¡Œæ¦œ API](docs/charts_api.md)
- [å›¾ç‰‡ç®¡ç† API](docs/image_api.md)
- [å†å²è®°å½• API](docs/history_api.md)
- [åº”ç”¨å‘å¸ƒ API](docs/releases_api.md)
- [ç”¨æˆ·å…³ç³» API](docs/relationship_api.md)
- [å¸–å­ç®¡ç† API](docs/posts_api.md)
- [ç‚¹èµåŠŸèƒ½ API](docs/likes_api.md)
- [å›å¤åŠŸèƒ½ API](docs/replies_api.md)
- [æ¨ªå¹…ç®¡ç† API](docs/banners_api.md)
- [çŸ­ä¿¡æœåŠ¡ API](docs/sms_api.md)

## ğŸ› ï¸ é¡¹ç›®ç»“æ„

```
SuperSpeedCalc-Server/
â”œâ”€â”€ app.py                 # Flaskåº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ config.py             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ start_production.py     # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬ (ç«¯å£ 8001)
â”œâ”€â”€ start_development.py    # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬ (ç«¯å£ 8000)
â”œâ”€â”€ models/               # æ•°æ®æ¨¡å‹
â”œâ”€â”€ routes/               # APIè·¯ç”±
â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ response.py       # æ ‡å‡†åŒ–å“åº”å·¥å…·ç±»
â”œâ”€â”€ uploads/              # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ docs/                 # APIæ–‡æ¡£
```

## ğŸ” å¥åº·æ£€æŸ¥

- **æµ‹è¯•ç¯å¢ƒ**: `http://localhost:8000/health`
- **æ­£å¼ç¯å¢ƒ**: `http://localhost:8001/health`

## ğŸ“ æ—¥å¿—

- æ§åˆ¶å°è¾“å‡ºï¼šå®æ—¶æ—¥å¿—
- æ–‡ä»¶æ—¥å¿—ï¼š`logs/app.log`

## ğŸ§ª æ¥å£æµ‹è¯•

### æµ‹è¯•çŠ¶æ€
- âœ… **åŒç¯å¢ƒæ”¯æŒ** - æµ‹è¯•ç¯å¢ƒ(8000) + æ­£å¼ç¯å¢ƒ(8001)
- âœ… **å“åº”æ ¼å¼æ ‡å‡†åŒ–** - æ‰€æœ‰æ¥å£ä½¿ç”¨ç»Ÿä¸€çš„ `code + message + data` æ ¼å¼
- âœ… **åŸºç¡€æ¥å£æµ‹è¯•é€šè¿‡** - ç”¨æˆ·åˆ—è¡¨æ¥å£è¿”å›æ­£ç¡®æ ¼å¼
- âœ… **ç”¨æˆ·æ¨¡å‹æ›´æ–°** - ç”¨æˆ·åå­—æ®µå¯ä¸ºç©ºï¼Œæ‰‹æœºå·å”¯ä¸€ä¸”å¯ä¸ºç©º
- âœ… **500é”™è¯¯ä¿®å¤** - æ‰€æœ‰æ¥å£è·¨è¡Œreturnè¯­å¥é—®é¢˜å·²è§£å†³
- âœ… **ç‚¹èµåŠŸèƒ½æµ‹è¯•é€šè¿‡** - ç‚¹èµ/å–æ¶ˆç‚¹èµåŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… **è¯„è®ºåŠŸèƒ½æµ‹è¯•é€šè¿‡** - ä¸€çº§è¯„è®ºå’ŒäºŒçº§å›å¤åŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… **ç¤¾äº¤åŠŸèƒ½éªŒè¯** - ç”¨æˆ·å…³ç³»ã€å¸–å­ç®¡ç†ã€äº’åŠ¨åŠŸèƒ½å…¨éƒ¨æµ‹è¯•é€šè¿‡

### å¿«é€Ÿæµ‹è¯•
```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
curl "http://localhost:8000/users?page=1&per_page=5"
curl "http://localhost:8000/posts?page=1&per_page=5"

# ç¤¾äº¤åŠŸèƒ½æµ‹è¯•
# ç‚¹èµå¸–å­
curl -X POST "http://localhost:8000/posts/{post_id}/like" \
  -H "Content-Type: application/json" \
  -d '{"user_id": "user123"}'

# å–æ¶ˆç‚¹èµ
curl -X DELETE "http://localhost:8000/posts/{post_id}/like" \
  -H "Content-Type: application/json" \
  -d '{"user_id": "user123"}'

# åˆ›å»ºè¯„è®º
curl -X POST "http://localhost:8000/replies/" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "è¿™æ˜¯ä¸€æ¡è¯„è®º",
    "post": "post123",
    "user": "user123"
  }'

# è·å–å¸–å­è¯„è®º
curl "http://localhost:8000/replies/post/{post_id}"

# é¢„æœŸå“åº”æ ¼å¼
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "items": [...],
    "pagination": {...}
  }
}
```

### ç”¨æˆ·æ¨¡å‹å˜æ›´
- **ç”¨æˆ·åå­—æ®µ**ï¼šç°åœ¨å¯ä»¥ä¸ºç©ºï¼Œä¸å†è¦æ±‚å”¯ä¸€æ€§
- **æ‰‹æœºå·å­—æ®µ**ï¼šä¿æŒå”¯ä¸€æ€§ï¼Œå¯ä»¥ä¸ºç©º
- **æ•°æ®åº“è¿ç§»**ï¼šå·²è‡ªåŠ¨å®Œæˆç”¨æˆ·åå­—æ®µçš„æ•°æ®åº“ç»“æ„æ›´æ–°

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**ï¼šä½¿ç”¨ä¸åŒçš„å¯åŠ¨è„šæœ¬ (`start_development.py` æˆ– `start_production.py`)
2. **æ•°æ®åº“é”™è¯¯**ï¼šæ£€æŸ¥ `instance/app_development.db` æˆ– `instance/app_production.db` æ–‡ä»¶æƒé™
3. **ä¾èµ–ç¼ºå¤±**ï¼šè¿è¡Œ `pip install -r requirements.txt`
4. **å“åº”æ ¼å¼**ï¼šæ‰€æœ‰æ¥å£å·²æ ‡å‡†åŒ–ï¼Œä½¿ç”¨ `utils/response.py` ä¸­çš„å·¥å…·å‡½æ•°
5. **æ¥å£è·¯å¾„**ï¼šæ³¨æ„æ¥å£è·¯å¾„æ²¡æœ‰ `/api` å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ `/users`ã€`/charts` ç­‰
6. **500é”™è¯¯**ï¼šå·²ä¿®å¤æ‰€æœ‰è·¨è¡Œreturnè¯­å¥é—®é¢˜ï¼Œç¡®ä¿æ‰€æœ‰æ¥å£æ­£å¸¸è¿”å›
7. **ç”¨æˆ·åå­—æ®µ**ï¼šç°åœ¨å¯ä»¥ä¸ºç©ºï¼Œæ³¨å†Œæ—¶ä¸éœ€è¦æä¾›ç”¨æˆ·å

### è°ƒè¯•æ¨¡å¼

å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œæ”¯æŒï¼š
- è‡ªåŠ¨é‡è½½
- è¯¦ç»†é”™è¯¯ä¿¡æ¯
- SQLæŸ¥è¯¢æ—¥å¿—

## ğŸŒ åŒç¯å¢ƒéƒ¨ç½²

### ç¯å¢ƒé…ç½®
é¡¹ç›®æ”¯æŒåŒç¯å¢ƒéƒ¨ç½²ï¼Œæ–¹ä¾¿å¼€å‘æµ‹è¯•å’Œç”Ÿäº§ä½¿ç”¨ï¼š

| ç¯å¢ƒ | å¯åŠ¨è„šæœ¬ | ç«¯å£ | ç”¨é€” | è®¿é—®åœ°å€ |
|------|----------|------|------|----------|
| å¼€å‘ç¯å¢ƒ | `start_development.py` | 8000 | å¼€å‘æµ‹è¯• | http://localhost:8000 |
| ç”Ÿäº§ç¯å¢ƒ | `start_production.py` | 8001 | ç”Ÿäº§éƒ¨ç½² | http://localhost:8001 |

### åŒæ—¶è¿è¡ŒåŒç¯å¢ƒ
```bash
# ç»ˆç«¯1 - å¯åŠ¨å¼€å‘ç¯å¢ƒ
python start_development.py

# ç»ˆç«¯2 - å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
python start_production.py
```

### ç¯å¢ƒåˆ‡æ¢
- **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨ `start_development.py` (ç«¯å£ 8000)
- **ç”Ÿäº§éƒ¨ç½²**ï¼šä½¿ç”¨ `start_production.py` (ç«¯å£ 8001)
- **å¹¶è¡Œæµ‹è¯•**ï¼šå¯åŒæ—¶è¿è¡Œä¸¤ä¸ªç¯å¢ƒè¿›è¡Œå¯¹æ¯”æµ‹è¯•

### æ•°æ®åº“åˆ†ç¦»
ä¸¤ä¸ªç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ•°æ®åº“æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®äº’ä¸å¹²æ‰°ï¼š
- **å¼€å‘ç¯å¢ƒ**: `instance/app_development.db`
- **ç”Ÿäº§ç¯å¢ƒ**: `instance/app_production.db`

### CORS é…ç½®
- **æœ¬åœ°å¼€å‘**: å¯ç”¨ CORSï¼Œæ”¯æŒè·¨åŸŸè¯·æ±‚ï¼Œä¾¿äºå‰ç«¯å¼€å‘è°ƒè¯•
- **æœåŠ¡å™¨éƒ¨ç½²**: ç¦ç”¨ CORSï¼ŒæœåŠ¡å™¨é€šå¸¸æœ‰åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰å¤„ç†è·¨åŸŸ

---

**æ³¨æ„**ï¼šè¿™æ˜¯å¼€å‘æœåŠ¡å™¨ï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ä¸“ä¸šçš„WSGIæœåŠ¡å™¨ã€‚
